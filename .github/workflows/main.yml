name: Email Sync Trigger

on:
  schedule:
    - cron: "0 */2 * * *"   # 每2小时（UTC）
  workflow_dispatch: {}

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Check backend version
        run: |
          set -e
          echo "Checking: ${{ secrets.HEALTH_URL }}"
          curl -sS "${{ secrets.HEALTH_URL }}" -w "\nHTTP_STATUS:%{http_code}\n"

      - name: Trigger email sync
        run: |
          set -e
          echo "Calling: ${{ secrets.CRON_URL }}"
          curl -sS -X POST "${{ secrets.CRON_URL }}" \
            -H "Authorization: Bearer ${{ secrets.JOB_CRON_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{"account":"customer_service_1@mzpropertygroup.com","max_per_run":50,"max_messages":50}' \
            --max-time 180 \
            -w "\nHTTP_STATUS:%{http_code}\n"
