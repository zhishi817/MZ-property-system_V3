# 发票导出 PDF 说明

## 导出原理

- 发票预览页使用 iframe 加载发票模板（HTML + CSS + JS）并渲染成 A4 版式。
- 导出 PDF 时，会等待 iframe 内图片与字体加载完成，然后对 `.inv-sheet` 进行截图（html2canvas），再按 A4 高度切片写入 PDF（jsPDF）。

## Logo（R2）加载策略

- 若公司 Logo 链接为 R2（例如 `*.r2.dev`），预览页会自动改为走后端代理 `/public/r2-image?url=...`。
- 代理会从 R2 直接读取对象并返回跨域允许的图片响应，避免浏览器截图阶段因跨域导致图片缺失。

## 常见问题与排查

- PDF 中图片缺失：优先检查 Logo 链接是否可访问；若为 R2 私有对象，需确保后端已配置 R2，并可通过代理接口返回 200。
- 字体显示异常：导出前会等待 `document.fonts.ready`（若浏览器支持）；仍异常时建议检查系统字体可用性与浏览器版本。
- 页面布局错乱：导出时会临时移除阴影/圆角/外层 padding，确保以 A4 内容区为准进行截图。

## 变更说明

- 预览页已移除“下载对比图 / 下载多端预览图 / 下载对齐报告”等调试入口，避免影响用户导出体验与维护成本。

