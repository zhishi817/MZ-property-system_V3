# 其他支出描述：长文本版式修复与中英文标点规则报告

## 1. 问题定位
在月报打印页中，“Other Income Desc / Other Expense Desc”这两行属于**描述文本**，但原实现使用了与金额相同的右对齐样式（`textAlign: right`）。当描述过长时会触发：
- 右对齐换行导致文本行首/行尾对齐不自然，造成视觉“错乱”
- 长词/长串在打印布局中更容易溢出或挤压表格列宽

## 2. 修复方案（自适应布局）
### 2.1 描述行布局
- 描述行的“值”列保持与金额列一致的右对齐边界，并启用自动换行（短文本右对齐更美观，长文本自动折行但右边界对齐保持一致）：
  - `whiteSpace: normal`
  - `wordBreak: break-word`
  - `overflowWrap: anywhere`
- 同时支持“完整显示模式”（不截断），以满足需要完整展示事项的场景。

### 2.2 中英文环境标点规则
- 中文环境（`lang=zh`）：列表分隔符使用 `、`，并规范化空格。
- 英文环境（`lang=en`）：将中文顿号 `、` 与中文逗号 `，` 统一转换为英文逗号 `,`，并规范化为 `, `（逗号+空格）。

## 3. 长度策略（不截断优先）
- 默认以“完整显示模式”为主：不截断文本，仅通过自动换行保证布局稳定。
- 仍保留可选的 `maxChars` 截断能力（按 Unicode codepoint 计数，避免截断表情/特殊字符），用于需要强制控制高度的页面。

## 4. 单元测试覆盖（Vitest）
测试文件：
- `src/lib/statementDesc.test.ts`

覆盖场景：
1) **中文长文本（含顿号）**：保持 `、`，并触发省略号截断
2) **英文长文本标点转换**：`、/，` → `,`
3) **极端长度边界**：`maxChars=0/1/…` 的截断稳定性
4) **不传 maxChars 不截断**：完整展示拼接后的文本内容

测试结果：
- `Test Files 8 passed`, `Tests 33 passed`

## 5. 中英文对比示例（修复前后）
### 5.1 中文环境（zh）
输入 items（示例）：
```
中文事项1、中文事项2、中文事项3、...（很长）
```
输出（示例）：
```
中文事项1、中文事项2、中文事项3、中文事项4、中文事项5…
```
说明：中文保留顿号分隔，超长自动省略，页面允许正常换行。

### 5.2 英文环境（en）
输入（示例，包含中文顿号/逗号）：
```
Lockbox storage fee、Cleaning of fan-coil unit filter，Replacement of shower spring
```
输出（示例）：
```
Lockbox storage fee, Cleaning of fan-coil unit filter, Replacement of shower spring
```
说明：英文环境统一使用英文逗号与空格格式，避免出现中文顿号。

## 6. 兼容性说明
- 本次仅对“显示层”做规范化与截断处理，不改变历史数据存储格式。
- 对既有字符串（已含 `,` 或 `、`）均可正常显示与转换，不影响旧数据。
